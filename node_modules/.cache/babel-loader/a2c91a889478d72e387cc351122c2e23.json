{"ast":null,"code":"var _jsxFileName = \"/Users/vonojastro/Desktop/lms-frontend-v2/src/components/Messaging/index.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { Fragment, useRef, useState } from \"react\";\nimport { useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport Pusher from 'pusher-js'; // import { getAllMyStudents } from \"api/class\";\n\nimport { getAPIKey, getCluster, getLiveChatRecipients, getLiveChatWithRecipients, getMyStudents, getMyTeachers, addLiveMessage } from \"api/messages\";\nimport { Autocomplete } from \"components/common/Form/Inputs\";\nimport { s3Config } from \"../../config\";\nimport S3 from \"aws-s3-pro\";\nimport './index.css';\nimport LocalizedFormat from 'dayjs/plugin/localizedFormat';\nimport utc from 'dayjs/plugin/utc';\nimport timezone from 'dayjs/plugin/timezone';\nimport dayjs from \"dayjs\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst s3Client = new S3(s3Config);\nexport default function Messaging() {\n  _s();\n\n  dayjs.extend(utc);\n  dayjs.extend(timezone);\n  dayjs.extend(LocalizedFormat);\n  const uploaderRef = useRef();\n  const dispatch = useDispatch();\n  const [newChat, setNewChat] = useState(\"\");\n  const [loading, setLoading] = useState({\n    recipients: true,\n    conversation: true,\n    sending: false\n  });\n  const [myContacts, setMyContacts] = useState([]);\n  const [composeMessage, setComposeMessage] = useState(false);\n  const [selectedRecipient, setSelectedRecipient] = useState();\n  const [recipients, setRecipients] = useState([]);\n  const [conversation, setConversation] = useState([]);\n  const [filterValue, setFilterValue] = useState(\"\"); // const [fileAttached, setFileAttached] = useState(\"\");\n\n  const {\n    accountId,\n    photo,\n    type\n  } = useSelector(state => state.auth ? state.auth.user : {});\n  useEffect(() => {\n    const pusher = new Pusher(getAPIKey(), {\n      cluster: getCluster(),\n      encrypted: true\n    });\n    const channel = pusher.subscribe('Chat');\n    channel.bind(`channel-${accountId}`, data => {\n      console.log(\"SELECTED RECIPIENT\", selectedRecipient);\n      console.log(\"CHAT DATA\", data);\n\n      if ((selectedRecipient === null || selectedRecipient === void 0 ? void 0 : selectedRecipient.accountId) === data.from) {\n        const convoTemp = [...conversation];\n        convoTemp.push({\n          'accountId': data.from,\n          'description': data.description\n        });\n        setConversation(convoTemp);\n        scrollToBottom();\n      }\n\n      const recepient = [...recipients];\n      let index = recepient.findIndex(item => item.accountId === data.from);\n\n      if (index > -1) {\n        recepient[index].latestChat = data.description;\n        setRecipients(recepient);\n      }\n    });\n    return () => {\n      pusher.unsubscribe('Chat');\n    };\n  }, [accountId, conversation, recipients, selectedRecipient]);\n  useEffect(() => {\n    setLoading(prevState => ({ ...prevState,\n      conversation: true,\n      recipients: true\n    }));\n    getLiveChatRecipients(dispatch, (status, data) => {\n      setLoading(prevState => ({ ...prevState,\n        recipients: false\n      }));\n\n      if (status && data.length > 0) {\n        setRecipients(data);\n        getConversation(data[0]);\n      } else {\n        setLoading(prevState => ({ ...prevState,\n          conversation: false\n        }));\n      }\n    });\n\n    if (type === 'teacher') {\n      getMyStudents(dispatch, (status, data) => {\n        if (status) {\n          setMyContacts(data);\n        }\n      });\n    } else {\n      getMyTeachers(dispatch, (status, data) => {\n        if (status) {\n          setMyContacts(data);\n        }\n      });\n    }\n\n    document.getElementById(\"msgEnd\").scrollIntoView(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const getConversation = async recipient => {\n    console.log(\"RECIPIENT\", recipient);\n    setLoading(prevState => ({ ...prevState,\n      conversation: true\n    }));\n    setComposeMessage(false);\n    await setSelectedRecipient(prevState => recipient);\n    getLiveChatWithRecipients(recipient.accountId, dispatch, (status, data) => {\n      setLoading(prevState => ({ ...prevState,\n        recipients: false,\n        conversation: false\n      }));\n\n      if (status) {\n        setConversation(data);\n        scrollToBottom();\n      }\n    });\n  };\n\n  const filterConversation = value => {\n    setFilterValue(value.toLowerCase());\n  };\n\n  const scrollToBottom = () => {\n    document.getElementById(\"msgEnd\") && document.getElementById(\"msgEnd\").scrollIntoView({\n      behavior: \"smooth\"\n    });\n  };\n\n  const getFileName = value => {\n    const file = value.split(\"/\");\n    return file[file.length - 1];\n  };\n\n  const handleOnComposeNewMessage = contact => {\n    const tempRecipients = [...recipients];\n    const filtered = tempRecipients.filter(item => item.accountId.toString() === contact.accountId.toString());\n\n    if (filtered.length < 1) {\n      tempRecipients.unshift(contact);\n      setSelectedRecipient(contact);\n      setRecipients(tempRecipients);\n      setConversation([]);\n    } else {\n      setSelectedRecipient(filtered[0]);\n      getConversation(filtered[0]);\n    }\n\n    setComposeMessage(false);\n  };\n\n  const sendMessage = async (msg, chatType) => {\n    if (newChat.trim() === \"\" && chatType !== 'file') return;\n    setNewChat(\"\");\n    setLoading(prevState => ({ ...prevState,\n      sending: true\n    }));\n    const messages = [...conversation];\n    messages.push({\n      accountId,\n      description: msg || newChat,\n      type: chatType || 'text',\n      photo,\n      status: 'pending'\n    });\n    await setConversation(messages);\n    scrollToBottom();\n    addLiveMessage({\n      recipientId: selectedRecipient.accountId,\n      description: msg || newChat,\n      type: chatType || 'text'\n    }, dispatch, status => {\n      setLoading(prevState => ({ ...prevState,\n        sending: false\n      }));\n\n      if (status) {\n        const messages2 = [...messages];\n        messages2[messages2.length - 1].status = \"sent\";\n        setConversation(messages2);\n      } else {\n        const messages2 = [...messages];\n        messages2[messages2.length - 1].status = \"failed\";\n        setConversation(messages2);\n      }\n    });\n  };\n\n  const handleOnKeyUp = event => {\n    if (event.keyCode === 13) {\n      event.preventDefault();\n      sendMessage();\n    }\n  };\n\n  const onAttachImage = async event => {\n    try {\n      //   setFileAttached(event.target.files[0]);\n      const uploadResponse = await s3Client.uploadFile(event.target.files[0]);\n\n      if (uploadResponse.status === 204) {\n        sendMessage(uploadResponse.location, \"file\");\n      }\n    } catch (error) {}\n  };\n\n  const getDate = dateTime => {\n    return dayjs(dateTime).tz(Intl.DateTimeFormat().resolvedOptions().timeZone ? Intl.DateTimeFormat().resolvedOptions().timeZone : \"Asia/Manila\").format(\"MMMM DD, YYYY\");\n  };\n\n  const displayDate = (conversations, index) => {\n    if (index === 0) {\n      return true;\n    } else {\n      if (getDate(conversations[index].updatedDateTime) > getDate(conversation[index - 1].updatedDateTime)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  const getTime = dateTime => {\n    return dayjs(dateTime).tz(Intl.DateTimeFormat().resolvedOptions().timeZone ? Intl.DateTimeFormat().resolvedOptions().timeZone : \"Asia/Manila\").format(\"hh:mm A\");\n  };\n\n  return /*#__PURE__*/_jsxDEV(Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      style: {\n        height: '75vh'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-4 h-100\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card h-100\",\n          style: {\n            background: \"rgb(255 255 255 / 40%)\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-center pt-3 pl-4 pr-2 d-flex justify-content-between align-items-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: \"Chats\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-link\",\n              \"data-toggle\": \"tooltip\",\n              title: \"New Message\",\n              onClick: () => setComposeMessage(true),\n              children: /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"fa fa-edit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 257,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"m-3\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                position: \"relative\"\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"input-group\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  className: \"form-control\",\n                  style: {\n                    borderRadius: '20px',\n                    paddingRight: '30px'\n                  },\n                  placeholder: \"Search\",\n                  onChange: e => filterConversation(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 263,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"input-icon mr-2\",\n                  children: /*#__PURE__*/_jsxDEV(\"i\", {\n                    className: \"fa fa-search\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 271,\n                    columnNumber: 37\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 270,\n                  columnNumber: 33\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 262,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ml-3 mr-3 mt-2\",\n            children: [loading.recipients && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-center data-loading\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"spinner-border text-primary\",\n                role: \"status\",\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"sr-only\",\n                  children: \"Loading...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 280,\n                  columnNumber: 33\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"loading-text\",\n                children: \"Loading messages...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 282,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 278,\n              columnNumber: 48\n            }, this), !loading.recipients && recipients.filter(r => r.name.toLowerCase().indexOf(filterValue) > -1).map((item, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n              role: \"button\",\n              className: `p-2 mb-4 d-flex ${(!selectedRecipient && index === 0 || selectedRecipient && selectedRecipient.accountId === item.accountId) && 'msg-active'}`,\n              onClick: () => getConversation(item),\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                src: item.photo ? item.photo : \"./assets/images/anonymous.png\",\n                alt: \"user\",\n                height: 50,\n                width: 50,\n                style: {\n                  objectFit: 'cover'\n                },\n                className: \"profile-pic\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 286,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ml-2 pt-3\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    lineHeight: '1px',\n                    marginBottom: '10px'\n                  },\n                  children: item.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 295,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                  style: {\n                    fontSize: '12px',\n                    color: 'gray'\n                  },\n                  children: item.latestChat\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 296,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 294,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 285,\n              columnNumber: 30\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-8 h-100\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card h-100\",\n          style: {\n            background: \"rgb(255 255 255 / 40%)\"\n          },\n          children: [composeMessage && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-body el-element-overlay\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `col-md-12`,\n              children: /*#__PURE__*/_jsxDEV(Autocomplete, {\n                name: \"salutation\",\n                placeholder: \"To\",\n                className: \"form-control\",\n                suggestions: myContacts,\n                defaultValue: \"\",\n                accessor: \"name\",\n                onSelect: selected => handleOnComposeNewMessage(selected)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 306,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              id: \"msgEnd\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 40\n          }, this), !composeMessage && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-body el-element-overlay\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pl-2 pr-2 d-flex\",\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                src: selectedRecipient !== null && selectedRecipient !== void 0 && selectedRecipient.photo ? selectedRecipient.photo : \"./assets/images/anonymous.png\",\n                alt: \"user\",\n                height: 50,\n                width: 50,\n                style: {\n                  objectFit: 'cover'\n                },\n                className: \"profile-pic\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 314,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ml-2 d-flex align-items-center\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: /*#__PURE__*/_jsxDEV(\"b\", {\n                    children: selectedRecipient === null || selectedRecipient === void 0 ? void 0 : selectedRecipient.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 323,\n                    columnNumber: 38\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 323,\n                  columnNumber: 33\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 322,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 313,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 326,\n              columnNumber: 25\n            }, this), loading.conversation && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-center data-loading\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"spinner-border text-primary\",\n                role: \"status\",\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"sr-only\",\n                  children: \"Loading...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 329,\n                  columnNumber: 33\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 328,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"loading-text\",\n                children: \"Loading conversation...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 331,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 327,\n              columnNumber: 50\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `msg-container ${type}`,\n              children: [!loading.conversation && conversation.map((item, index) => {\n                var _conversation, _conversation2, _conversation3, _conversation4;\n\n                item.position = item.accountId === accountId ? 'right' : 'left';\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [displayDate(conversation, index) && /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"text-center\",\n                    children: getDate(item.updatedDateTime)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 338,\n                    columnNumber: 74\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `d-flex ${item.position === 'right' ? 'flex-row-reverse' : ''} \n                                    ${item.accountId === ((_conversation = conversation[index - 1]) === null || _conversation === void 0 ? void 0 : _conversation.accountId) ? 'mt-1' : 'mt-4'} msg-row`,\n                    children: [(index === 0 || item.accountId !== ((_conversation2 = conversation[index - 1]) === null || _conversation2 === void 0 ? void 0 : _conversation2.accountId)) && /*#__PURE__*/_jsxDEV(\"img\", {\n                      src: item.photo ? item.photo : \"./assets/images/anonymous.png\",\n                      alt: \"user\",\n                      height: 50,\n                      width: 50,\n                      style: {\n                        objectFit: 'cover'\n                      },\n                      className: `profile-pic ${item.position === 'right' ? 'ml-4' : 'mr-2'}`\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 341,\n                      columnNumber: 110\n                    }, this), item.type !== 'file' && /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: `${index === 0 || item.accountId !== ((_conversation3 = conversation[index - 1]) === null || _conversation3 === void 0 ? void 0 : _conversation3.accountId) ? 'speech-bubble-1' : 'speech-bubble-2'} ${item.position} ${item.status}`,\n                      children: item.description\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 348,\n                      columnNumber: 62\n                    }, this), item.type === 'file' && /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: `${index === 0 || item.accountId !== ((_conversation4 = conversation[index - 1]) === null || _conversation4 === void 0 ? void 0 : _conversation4.accountId) ? 'speech-bubble-1' : 'speech-bubble-2'} ${item.position} ${item.status}`,\n                      children: /*#__PURE__*/_jsxDEV(\"a\", {\n                        href: item.description,\n                        target: \"_blank\",\n                        rel: \"noreferrer\",\n                        children: /*#__PURE__*/_jsxDEV(\"i\", {\n                          className: \"fa fa-paperclip\",\n                          children: [\" \", getFileName(item.description)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 355,\n                          columnNumber: 45\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 354,\n                        columnNumber: 41\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 352,\n                      columnNumber: 62\n                    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 358,\n                      columnNumber: 37\n                    }, this), item.status === 'failed' && /*#__PURE__*/_jsxDEV(\"i\", {\n                      \"data-toggle\": \"tooltip\",\n                      title: \"Sending Failed\",\n                      className: \"fa fa-exclamation-circle\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 360,\n                      columnNumber: 66\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 339,\n                    columnNumber: 33\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `d-flex ${item.position === 'right' ? 'flex-row-reverse' : ''} msg-row`,\n                    style: {\n                      fontSize: '12px',\n                      marginLeft: item.position === 'right' ? '' : '80px',\n                      marginRight: item.position === 'right' ? '80px' : ''\n                    },\n                    children: [getTime(item.updatedDateTime), \" \"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 362,\n                    columnNumber: 34\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 337,\n                  columnNumber: 33\n                }, this);\n              }), /*#__PURE__*/_jsxDEV(\"div\", {\n                id: \"msgEnd\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 365,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 333,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              name: \"upload\",\n              ref: uploaderRef,\n              type: \"file\" // accept=\".png, .jpg, .jpeg\"\n              ,\n              style: {\n                display: \"none\"\n              },\n              onChange: onAttachImage\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                bottom: '1rem',\n                position: 'absolute',\n                width: '95%'\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: \"relative\"\n                },\n                className: \"d-flex align-items-center align-items-stretch\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"input-group\",\n                  children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"text\",\n                    className: \"form-control\" // style={{borderRadius: '20px', paddingRight: '35px'}}\n                    // rows={1}\n                    ,\n                    placeholder: \"Message\",\n                    value: newChat,\n                    onKeyUp: e => handleOnKeyUp(e),\n                    onChange: e => setNewChat(e.target.value)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 383,\n                    columnNumber: 37\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    role: \"button\",\n                    className: \"input-icon mr-3\",\n                    \"data-toggle\": \"tooltip\",\n                    title: \"Add attachment\",\n                    onClick: () => uploaderRef.current.click(),\n                    children: /*#__PURE__*/_jsxDEV(\"i\", {\n                      className: \"fa fa-paperclip\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 397,\n                      columnNumber: 41\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 393,\n                    columnNumber: 37\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 382,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn btn-primary\",\n                  type: \"button\",\n                  onClick: () => sendMessage(),\n                  children: /*#__PURE__*/_jsxDEV(\"i\", {\n                    className: \"fa fa-paper-plane\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 401,\n                    columnNumber: 37\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 400,\n                  columnNumber: 33\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 378,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 377,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 41\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 250,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Messaging, \"RmD1UkaS/pjY56Bk68MeNwTj28A=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c = Messaging;\n\nvar _c;\n\n$RefreshReg$(_c, \"Messaging\");","map":{"version":3,"sources":["/Users/vonojastro/Desktop/lms-frontend-v2/src/components/Messaging/index.jsx"],"names":["React","Fragment","useRef","useState","useEffect","useDispatch","useSelector","Pusher","getAPIKey","getCluster","getLiveChatRecipients","getLiveChatWithRecipients","getMyStudents","getMyTeachers","addLiveMessage","Autocomplete","s3Config","S3","LocalizedFormat","utc","timezone","dayjs","s3Client","Messaging","extend","uploaderRef","dispatch","newChat","setNewChat","loading","setLoading","recipients","conversation","sending","myContacts","setMyContacts","composeMessage","setComposeMessage","selectedRecipient","setSelectedRecipient","setRecipients","setConversation","filterValue","setFilterValue","accountId","photo","type","state","auth","user","pusher","cluster","encrypted","channel","subscribe","bind","data","console","log","from","convoTemp","push","description","scrollToBottom","recepient","index","findIndex","item","latestChat","unsubscribe","prevState","status","length","getConversation","document","getElementById","scrollIntoView","recipient","filterConversation","value","toLowerCase","behavior","getFileName","file","split","handleOnComposeNewMessage","contact","tempRecipients","filtered","filter","toString","unshift","sendMessage","msg","chatType","trim","messages","recipientId","messages2","handleOnKeyUp","event","keyCode","preventDefault","onAttachImage","uploadResponse","uploadFile","target","files","location","error","getDate","dateTime","tz","Intl","DateTimeFormat","resolvedOptions","timeZone","format","displayDate","conversations","updatedDateTime","getTime","height","background","position","borderRadius","paddingRight","e","r","name","indexOf","map","objectFit","lineHeight","marginBottom","fontSize","color","selected","marginLeft","marginRight","display","bottom","width","current","click"],"mappings":"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","sourcesContent":["import React, {Fragment, useRef, useState } from \"react\";\nimport { useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport Pusher from 'pusher-js';\n// import { getAllMyStudents } from \"api/class\";\nimport {\n    getAPIKey,\n    getCluster,\n    getLiveChatRecipients,\n    getLiveChatWithRecipients,\n    getMyStudents,\n    getMyTeachers,\n    addLiveMessage} from \"api/messages\";\nimport { Autocomplete } from \"components/common/Form/Inputs\";\nimport { s3Config } from \"../../config\";\nimport S3 from \"aws-s3-pro\";\nimport './index.css';\nimport LocalizedFormat from 'dayjs/plugin/localizedFormat';\nimport utc from 'dayjs/plugin/utc';\nimport timezone from 'dayjs/plugin/timezone';\nimport dayjs from \"dayjs\";\n\nconst s3Client = new S3(s3Config);\n\nexport default function Messaging() {\n    dayjs.extend(utc);\n    dayjs.extend(timezone);\n    dayjs.extend(LocalizedFormat);\n\n    const uploaderRef = useRef();\n    const dispatch = useDispatch();\n    const [newChat, setNewChat] = useState(\"\");\n    const [loading, setLoading] = useState({\n        recipients: true, \n        conversation: true, \n        sending: false, \n    });\n    const [myContacts, setMyContacts] = useState([]);\n    const [composeMessage, setComposeMessage] = useState(false);\n    const [selectedRecipient, setSelectedRecipient] = useState();\n    const [recipients, setRecipients] = useState([]);\n    const [conversation, setConversation] = useState([]);\n    const [filterValue, setFilterValue] = useState(\"\");\n    // const [fileAttached, setFileAttached] = useState(\"\");\n\n    const { accountId, photo, type } = useSelector((state) => state.auth ? state.auth.user : {});    \n\n    useEffect(() => {\n        const pusher = new Pusher(getAPIKey(), {\n            cluster: getCluster(),\n            encrypted: true\n        });\n        const channel = pusher.subscribe('Chat');\n        channel.bind(`channel-${accountId}`, (data) => {\n            console.log(\"SELECTED RECIPIENT\", selectedRecipient);\n            console.log(\"CHAT DATA\", data);\n            if (selectedRecipient?.accountId === data.from)\n            {\n                const convoTemp = [...conversation];\n                convoTemp.push({\n                    'accountId': data.from,\n                    'description' :data.description\n                });\n                setConversation(convoTemp);\n                scrollToBottom();\n            }\n            const recepient = [...recipients];\n            let index = recepient.findIndex((item)=>item.accountId === data.from);\n            if (index > -1)\n            {\n                recepient[index].latestChat = data.description;\n                setRecipients(recepient);\n            }\n            \n        });\n\n        return () =>{\n            pusher.unsubscribe('Chat');\n        }\n    }, [accountId, conversation, recipients, selectedRecipient]);\n\n  useEffect(() => {\n    setLoading(prevState => ({\n        ...prevState,\n        conversation: true,\n        recipients: true\n    }));\n  \n    getLiveChatRecipients(dispatch, (status, data) => {\n        setLoading(prevState => ({\n            ...prevState,\n            recipients: false\n        }));\n\n        if(status && data.length > 0){\n            setRecipients(data);\n            getConversation(data[0]);\n        }else{\n            setLoading(prevState => ({\n                ...prevState,\n                conversation: false\n            }));\n        }\n    });\n    if(type === 'teacher'){\n        getMyStudents(dispatch, (status, data) => {\n            if(status){\n                setMyContacts(data);\n            }\n        });\n    }else{\n        getMyTeachers(dispatch, (status, data) => {\n            if(status){\n                setMyContacts(data);\n            }\n        });\n    }\n    document.getElementById(\"msgEnd\").scrollIntoView();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const getConversation = async (recipient) => {\n      console.log(\"RECIPIENT\", recipient);\n    setLoading(prevState => ({\n        ...prevState,\n        conversation: true\n    }));\n    setComposeMessage(false);\n    await setSelectedRecipient(prevState => (recipient));\n    getLiveChatWithRecipients(recipient.accountId, dispatch, (status, data) => {\n        setLoading(prevState => ({\n            ...prevState,\n            recipients: false,\n            conversation: false\n        }));\n        \n        if(status){\n            setConversation(data);\n            scrollToBottom();\n        }\n    });\n  }\n\n  const filterConversation = (value) => {\n    setFilterValue(value.toLowerCase());\n  }\n\n  const scrollToBottom = () => {\n    document.getElementById(\"msgEnd\") && document.getElementById(\"msgEnd\").scrollIntoView({ behavior: \"smooth\" });\n  }\n\n  const getFileName = (value) => {\n      const file = value.split(\"/\");\n      return file[file.length-1];\n  }\n\n  const handleOnComposeNewMessage = (contact) =>{\n    const tempRecipients = [...recipients];\n    const filtered = tempRecipients.filter(item => item.accountId.toString() === contact.accountId.toString());\n    if(filtered.length < 1){\n        tempRecipients.unshift(contact);\n        setSelectedRecipient(contact);\n        setRecipients(tempRecipients);\n        setConversation([]);\n    }else{\n        setSelectedRecipient(filtered[0]);\n        getConversation(filtered[0]);\n    }\n    setComposeMessage(false);\n  }\n\n  const sendMessage = async (msg, chatType) => {\n    if(newChat.trim() === \"\" && chatType !== 'file') return;\n    \n    setNewChat(\"\");\n    setLoading(prevState => ({\n        ...prevState,\n        sending: true\n    }));\n\n    const messages = [...conversation];\n    messages.push({\n        accountId,\n        description: msg || newChat,\n        type: chatType || 'text',\n        photo,\n        status: 'pending'\n    });\n    await setConversation(messages);\n    scrollToBottom();\n\n    addLiveMessage({recipientId: selectedRecipient.accountId, description: msg || newChat, type: chatType || 'text'}, dispatch, (status) => {\n        setLoading(prevState => ({\n            ...prevState,\n            sending: false\n        }));\n        if(status){\n            const messages2 = [...messages];\n            messages2[messages2.length-1].status=\"sent\";\n            setConversation(messages2);\n        }else{\n            const messages2 = [...messages];\n            messages2[messages2.length-1].status=\"failed\";\n            setConversation(messages2);\n        }\n    });\n  }\n\n  const handleOnKeyUp = (event) => {\n    if (event.keyCode === 13) {\n        event.preventDefault();\n        sendMessage();\n    }\n  }\n\n  const onAttachImage = async (event) => {\n    try {\n    //   setFileAttached(event.target.files[0]);\n        const uploadResponse = await s3Client.uploadFile(event.target.files[0]);\n      if (uploadResponse.status === 204) {\n        sendMessage(uploadResponse.location, \"file\");\n      }\n    } catch (error) {}\n  }\n\n  const getDate = (dateTime) =>{\n    return dayjs(dateTime).tz(Intl.DateTimeFormat().resolvedOptions().timeZone ? Intl.DateTimeFormat().resolvedOptions().timeZone : \"Asia/Manila\").format(\"MMMM DD, YYYY\");\n  }\n\n  const displayDate = (conversations, index) =>{\n    if (index === 0)\n    {\n      return true;  \n    }\n    else\n    {\n        if (getDate(conversations[index].updatedDateTime) > getDate(conversation[index-1].updatedDateTime))\n        {\n            return true;\n        }\n    }\n    return false;\n  }\n\n  const getTime = (dateTime) =>{\n    return dayjs(dateTime).tz(Intl.DateTimeFormat().resolvedOptions().timeZone ? Intl.DateTimeFormat().resolvedOptions().timeZone : \"Asia/Manila\").format(\"hh:mm A\");\n  } \n\n  return (\n    <Fragment>\n        <div className=\"row\" style={{height: '75vh'}}>\n            <div className=\"col-4 h-100\">\n                <div className=\"card h-100\" style={{background: \"rgb(255 255 255 / 40%)\"}}>\n                    <div className=\"text-center pt-3 pl-4 pr-2 d-flex justify-content-between align-items-center\">\n                        <h4>Chats</h4>\n                        <button className=\"btn btn-link\" data-toggle=\"tooltip\" title=\"New Message\" onClick={() => setComposeMessage(true)}>\n                            <i className=\"fa fa-edit\"></i>\n                        </button>\n                    </div>\n                    <div className=\"m-3\">\n                        <div style={{ position: \"relative\" }}>\n                            <div className=\"input-group\">\n                                <input\n                                    type=\"text\"\n                                    className=\"form-control\"\n                                    style={{borderRadius: '20px', paddingRight: '30px'}}\n                                    placeholder=\"Search\"\n                                    onChange={(e) => filterConversation(e.target.value)}\n                                />\n                                <span className=\"input-icon mr-2\">\n                                    <i className=\"fa fa-search\"></i>\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"ml-3 mr-3 mt-2\">\n                        {loading.recipients && <div className=\"text-center data-loading\">\n                            <div className=\"spinner-border text-primary\" role=\"status\">\n                                <span className=\"sr-only\">Loading...</span>\n                            </div>\n                            <div className=\"loading-text\">Loading messages...</div>\n                        </div>}\n                        {!loading.recipients && (recipients.filter(r => r.name.toLowerCase().indexOf(filterValue) > -1)).map((item, index) => \n                            (<div role=\"button\" className={`p-2 mb-4 d-flex ${((!selectedRecipient && index === 0) || (selectedRecipient && selectedRecipient.accountId === item.accountId)) && 'msg-active'}`} onClick={() => getConversation(item)}>\n                                <img\n                                    src={item.photo ? item.photo: \"./assets/images/anonymous.png\"}\n                                    alt=\"user\"\n                                    height={50}\n                                    width={50}\n                                    style={{objectFit: 'cover'}}\n                                    className=\"profile-pic\"\n                                    />\n                                <div className=\"ml-2 pt-3\">\n                                    <div style={{lineHeight: '1px', marginBottom: '10px'}}>{item.name}</div>\n                                    <small style={{fontSize: '12px', color: 'gray'}}>{item.latestChat}</small>\n                                </div>\n                            </div>))}\n                    </div>\n                </div>\n            </div>\n            <div className=\"col-8 h-100\">\n                <div className=\"card h-100\" style={{background: \"rgb(255 255 255 / 40%)\"}}>\n                    {composeMessage && <div className=\"card-body el-element-overlay\">\n                        <div className={`col-md-12`}>\n                            <Autocomplete name=\"salutation\" placeholder=\"To\" className='form-control' \n                                suggestions={myContacts} defaultValue={\"\"} \n                                accessor={\"name\"} onSelect={(selected) => handleOnComposeNewMessage(selected)}/>\n                        </div>\n                        <div id=\"msgEnd\"></div>\n                    </div>}\n                    {!composeMessage && <div className=\"card-body el-element-overlay\">\n                        <div className=\"pl-2 pr-2 d-flex\">\n                            <img\n                                src={selectedRecipient?.photo ? selectedRecipient.photo : \"./assets/images/anonymous.png\"}\n                                alt=\"user\"\n                                height={50}\n                                width={50}\n                                style={{objectFit: 'cover'}}\n                                className=\"profile-pic\"\n                                />\n                            <div className=\"ml-2 d-flex align-items-center\">\n                                <div><b>{selectedRecipient?.name}</b></div>\n                            </div>\n                        </div>\n                        <hr />\n                        {loading.conversation && <div className=\"text-center data-loading\">\n                            <div className=\"spinner-border text-primary\" role=\"status\">\n                                <span className=\"sr-only\">Loading...</span>\n                            </div>\n                            <div className=\"loading-text\">Loading conversation...</div>\n                        </div>}\n                        <div className={`msg-container ${type}`}>\n                            {!loading.conversation && conversation.map((item, index) => {\n                                item.position = item.accountId === accountId ? 'right' : 'left';\n                                return (\n                                <div>\n                                    {displayDate(conversation, index) && <div className=\"text-center\">{getDate(item.updatedDateTime)}</div>}\n                                <div className={`d-flex ${item.position === 'right' ? 'flex-row-reverse':''} \n                                    ${(item.accountId===conversation[index-1]?.accountId) ? 'mt-1':'mt-4'} msg-row`}>\n                                    {(index === 0 || (item.accountId!==conversation[index-1]?.accountId)) && <img\n                                        src={item.photo ? item.photo: \"./assets/images/anonymous.png\"}\n                                        alt=\"user\"\n                                        height={50}\n                                        width={50}\n                                        style={{objectFit: 'cover'}}\n                                        className={`profile-pic ${item.position === 'right' ? 'ml-4':'mr-2'}`}/>}\n                                    {item.type !== 'file' && <div className={`${(index === 0 || (item.accountId!==conversation[index-1]?.accountId)) \n                                            ? 'speech-bubble-1':'speech-bubble-2'} ${item.position} ${item.status}`}>\n                                        {item.description}\n                                    </div>}\n                                    {item.type === 'file' && <div className={`${(index === 0 || (item.accountId!==conversation[index-1]?.accountId)) \n                                            ? 'speech-bubble-1':'speech-bubble-2'} ${item.position} ${item.status}`}>\n                                        <a href={item.description} target=\"_blank\" rel=\"noreferrer\">\n                                            <i className=\"fa fa-paperclip\"> {getFileName(item.description)}</i>\n                                        </a>\n                                    </div>}\n                                    <br/>\n                                    \n                                    {item.status === 'failed' && <i data-toggle=\"tooltip\" title=\"Sending Failed\" className=\"fa fa-exclamation-circle\"></i>}\n                                </div>\n                                {<div className={`d-flex ${item.position === 'right' ? 'flex-row-reverse':''} msg-row`} style={{fontSize:'12px', marginLeft: (item.position === 'right') ? '' :'80px', marginRight: (item.position === 'right') ? '80px' : ''}}>{getTime(item.updatedDateTime)} </div>}\n                                </div>)\n                            })}\n                            <div id=\"msgEnd\"></div>\n                        </div>\n \n                        {/* <input type=\"file\" id=\"attach-file\" hidden/> */}\n                        <input\n                            name=\"upload\"\n                            ref={uploaderRef}\n                            type=\"file\"\n                            // accept=\".png, .jpg, .jpeg\"\n                            style={{ display: \"none\" }}\n                            onChange={onAttachImage} \n                            />\n                        <div style={{bottom: '1rem', position: 'absolute', width: '95%'}}>\n                            <div style={{ position: \"relative\" }} className=\"d-flex align-items-center align-items-stretch\">\n                                {/* <button className=\"btn btn-link\">\n                                    <i className=\"fa fa-paperclip\"></i>\n                                </button> */}\n                                <div className=\"input-group\">\n                                    <input\n                                        type=\"text\"\n                                        className=\"form-control\"\n                                        // style={{borderRadius: '20px', paddingRight: '35px'}}\n                                        // rows={1}\n                                        placeholder=\"Message\"\n                                        value={newChat}\n                                        onKeyUp={(e) => handleOnKeyUp(e)}\n                                        onChange={(e) => setNewChat(e.target.value)}\n                                    />\n                                    <span role=\"button\" className=\"input-icon mr-3\" \n                                        data-toggle=\"tooltip\"\n                                        title=\"Add attachment\"\n                                        onClick={() => uploaderRef.current.click()}>\n                                        <i className=\"fa fa-paperclip\"></i>\n                                    </span>\n                                </div>\n                                <button className=\"btn btn-primary\" type=\"button\" onClick={() => sendMessage()}>\n                                    <i className=\"fa fa-paper-plane\"></i>\n                                </button>                               \n                            </div>\n                        </div>\n                    </div>}\n                </div>\n            </div>\n        </div>\n    </Fragment>\n  );\n}"]},"metadata":{},"sourceType":"module"}