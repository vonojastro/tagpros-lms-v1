{"ast":null,"code":"var _jsxFileName = \"/Users/vonojastro/Desktop/lms-frontend-v2/src/components/SearchDetail/EnrollToClassForm/index.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Form } from \"react-final-form\";\nimport { CheckboxGroupControl } from \"../../common/Form/Inputs\"; // import { enrollClassSoloLearner } from \"api/classEnroll\";\n\nimport { enrollClassSuccess } from '../../../redux/actions/class'; // import { enrollClassSoloLearner, enrollClassFamily } from \"api/classEnroll\";\n\nimport { Button, Modal } from \"react-bootstrap\";\nimport \"./index.css\";\nimport { USER_TYPE, CLASS_STATUS, CLASS_STATUS_ALERT } from \"utils/constants\";\nimport { useNavigate } from \"react-router-dom\";\nimport { api } from '../../../api';\nimport LocalizedFormat from 'dayjs/plugin/localizedFormat';\nimport utc from 'dayjs/plugin/utc';\nimport timezone from 'dayjs/plugin/timezone';\nimport isSameOrAfter from 'dayjs/plugin/isSameOrAfter';\nimport isSameOrBefore from 'dayjs/plugin/isSameOrBefore';\nimport dayjs from \"dayjs\";\nimport { useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function EnrollToClassForm(_ref) {\n  _s();\n\n  let {\n    userType,\n    learners,\n    classDetails,\n    addToCart\n  } = _ref;\n  dayjs.extend(utc);\n  dayjs.extend(timezone);\n  dayjs.extend(isSameOrAfter);\n  dayjs.extend(isSameOrBefore);\n  dayjs.extend(LocalizedFormat);\n  const [modalShow, setModalShow] = useState(false);\n  const [promptShow, setPromptShow] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [classStatus, setStatus] = useState(\"\");\n  const isFamilyAccount = USER_TYPE.FMLY.toLowerCase() === userType;\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n\n  const getOptions = () => learners.map(learner => ({\n    label: learner.nickname,\n    value: learner\n  }));\n\n  const {\n    status,\n    message\n  } = useSelector(state => state.classes.get('enroll') ? state.classes.get('enroll') : {});\n  const {\n    classId\n  } = classDetails;\n  const isLoggedIn = useSelector(state => state.auth.authToken);\n\n  const checkIfEnrolledToClass = async (callback, learners) => {\n    const learnersParam = learners ? learners.map(item => item.id) : null;\n    await api.post(\"/class-enroll/availability\", {\n      classId,\n      userType,\n      learners: learners ? learnersParam.join(\",\") : null\n    }).then(response => {\n      if (response.data.status === 'success') {\n        callback(true);\n      }\n    }).catch(err => {\n      dispatch(enrollClassSuccess(err.response.data));\n      setModalShow(true);\n      callback(false);\n    });\n    setIsLoading(false);\n  };\n\n  const handleAddToCart = async values => {\n    setIsLoading(true);\n    checkIfEnrolledToClass(status => {\n      if (status) {\n        addToCart(values);\n      }\n    }, values ? values.learners : null);\n  };\n\n  const submit = async values => {\n    // We pass relevant information to CheckoutPage through location.state\n    // CheckoutPage accesses state with useLocation hook\n    setIsLoading(true);\n    classDetails.enrollees = values ? values.learners : null;\n    checkIfEnrolledToClass(status => {\n      if (status) {\n        navigate(`/checkout`, {\n          state: {\n            classId,\n            classes: [classDetails]\n          }\n        });\n      }\n    }, values ? values.learners : null);\n  };\n\n  const modalSubmit = action => {\n    switch (action) {\n      case 'cancel':\n        navigate('/');\n        break;\n\n      case 'proceed':\n        navigate(`/checkout`, {\n          state: {\n            classId,\n            classes: [classDetails]\n          }\n        });\n        break;\n\n      default:\n        return;\n    }\n  };\n\n  const Wrapper = styled.span`\n    .btn-success {\n      background: green;\n      border: 1px solid green;\n      text-transform: uppercase;\n    }\n  `;\n  useEffect(() => {\n    // const enrollmentStart = classDetails.enrollmentStartDate;\n    // const enrollmentEnd = classDetails.enrollmentEndDate;\n    const startDate = classDetails.classType === \"CLT002\" ? classDetails.startDate : classDetails.availabilityStartDate;\n    const endDate = classDetails.classType === \"CLT002\" ? classDetails.endDate : classDetails.availabilityEndDate;\n    console.log(startDate);\n    console.log(endDate);\n\n    if (classDetails.status === 'CSTAT010') {\n      setStatus(\"CLASS_ONGOING\");\n    } else if (classDetails.status === 'CSTAT011') {\n      setStatus(\"CLASS_ENDED\");\n    } else {\n      // if(!!enrollmentStart && dayjs().isBefore(dayjs(enrollmentStart), new Date())){\n      //     setStatus(\"NOT_STARTED\")\n      // }else  if(!!enrollmentStart && !!enrollmentEnd && dayjs().isSameOrAfter(dayjs(enrollmentStart), new Date()) && dayjs().isSameOrBefore(dayjs(enrollmentEnd), new Date())){\n      if (!!startDate && dayjs().isSameOrBefore(startDate)) {\n        setStatus(\"ONGOING_ENROLLMENT\");\n      } // else if(!!enrollmentEnd && !!startDate && dayjs().isAfter(dayjs(enrollmentEnd), new Date()) && dayjs().isBefore(dayjs(startDate), new Date())){\n      //     setStatus(\"OPENS_SOON\")\n      // }\n      else if (!!startDate && !!endDate && dayjs().isSameOrAfter(dayjs(startDate), new Date()) && dayjs().isSameOrBefore(dayjs(endDate), new Date())) {\n        setStatus(\"CLASS_ONGOING\");\n      } else {\n        setStatus(\"CLASS_ENDED\");\n      }\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n\n  const handleOnSubmit = () => {\n    if (!isLoggedIn) {\n      setPromptShow(true);\n    } else {\n      submit();\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: [/*#__PURE__*/_jsxDEV(Form, {\n      onSubmit: handleOnSubmit // onSubmit={!isLoggedIn ? () => window.location.href = '/register' : submit}\n      ,\n      render: _ref2 => {\n        var _values$learners, _values$learners2;\n\n        let {\n          handleSubmit,\n          values\n        } = _ref2;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-4 pt-4\",\n          style: {\n            borderTop: \"1px solid #DDD\"\n          },\n          children: [isFamilyAccount && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-xs-12 col-md-6\",\n              children: /*#__PURE__*/_jsxDEV(\"h5\", {\n                children: \"Who will attend this class?\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 144,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 143,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-xs-12 col-md-6 text-right\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 146,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 15\n          }, this), classStatus === 'ONGOING_ENROLLMENT' && /*#__PURE__*/_jsxDEV(\"form\", {\n            onSubmit: handleSubmit,\n            id: \"enroll-to-class\",\n            children: [isFamilyAccount && /*#__PURE__*/_jsxDEV(CheckboxGroupControl, {\n              options: getOptions(),\n              name: \"learners\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 154,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-success mt-2 w-100\",\n              disabled: (isFamilyAccount ? !((_values$learners = values.learners) !== null && _values$learners !== void 0 && _values$learners.length) > 0 : false) || isLoading,\n              onClick: !isLoggedIn ? () => window.location.href = '/register' : () => handleAddToCart(values),\n              type: \"button\" // onClick={onClickEnrollClass}\n              // disabled={!learnerId && userType !== USER_TYPE.LRNR.toLowerCase()}\n              ,\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                style: {\n                  display: isLoading ? 'inline-block' : 'none'\n                },\n                class: \"spinner-border spinner-border-sm btn-load\",\n                role: \"status\",\n                \"aria-hidden\": \"true\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 166,\n                columnNumber: 17\n              }, this), \"Add to Cart\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-success mt-2 w-100\",\n              disabled: (isFamilyAccount ? !((_values$learners2 = values.learners) !== null && _values$learners2 !== void 0 && _values$learners2.length) > 0 : false) || isLoading || classDetails.status !== CLASS_STATUS.APPROVEDEDUC // onClick={onClickEnrollClass}\n              // disabled={!learnerId && userType !== USER_TYPE.LRNR.toLowerCase()}\n              ,\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                style: {\n                  display: isLoading ? 'inline-block' : 'none'\n                },\n                class: \"spinner-border spinner-border-sm btn-load\",\n                role: \"status\",\n                \"aria-hidden\": \"true\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 176,\n                columnNumber: 17\n              }, this), \"ENROLL NOW\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 169,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 54\n          }, this), classStatus !== \"\" && classStatus !== 'ONGOING_ENROLLMENT' && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `alert alert-${CLASS_STATUS_ALERT[classStatus].type} text-center`,\n            role: \"alert\",\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: `${CLASS_STATUS_ALERT[classStatus].icon} mr-2`,\n              style: {\n                color: \"orange\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 17\n            }, this), CLASS_STATUS_ALERT[classStatus].message]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 76\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 11\n        }, this);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      size: \"m\",\n      show: modalShow,\n      onHide: () => setModalShow(false),\n      children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n        closeButton: true,\n        children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n          children: status === \"success\" ? \"Enrollment Pending\" : \"Enrollment Failed\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [message, \" \", status === \"success\" ? \"Proceed to Payment?\" : \"Find other classes?\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n        children: [status === \"error\" && /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"primary\",\n          onClick: () => modalSubmit(\"cancel\"),\n          children: \"Continue\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 13\n        }, this), status === \"success\" && /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"link\",\n          onClick: () => modalSubmit(\"cancel\"),\n          children: \"Maybe Later\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 13\n        }, this), status === \"success\" && /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"primary\",\n          onClick: () => modalSubmit(\"proceed\"),\n          children: \"Proceed\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      size: \"m\",\n      show: promptShow,\n      onHide: () => setPromptShow(false),\n      children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n        closeButton: true,\n        children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n          children: \"Continue to Login/Register?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"You should login to your account to proceed with enrollment.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          variant: \"danger\",\n          onClick: () => setPromptShow(false),\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"primary\",\n          onClick: () => window.location.href = '/register',\n          children: \"Proceed\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 135,\n    columnNumber: 5\n  }, this);\n}\n\n_s(EnrollToClassForm, \"FhrL3yHIjDmTnVL4y8Wlj4yZdZQ=\", false, function () {\n  return [useNavigate, useDispatch, useSelector, useSelector];\n});\n\n_c = EnrollToClassForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"EnrollToClassForm\");","map":{"version":3,"sources":["/Users/vonojastro/Desktop/lms-frontend-v2/src/components/SearchDetail/EnrollToClassForm/index.jsx"],"names":["React","useState","useDispatch","useSelector","Form","CheckboxGroupControl","enrollClassSuccess","Button","Modal","USER_TYPE","CLASS_STATUS","CLASS_STATUS_ALERT","useNavigate","api","LocalizedFormat","utc","timezone","isSameOrAfter","isSameOrBefore","dayjs","useEffect","styled","EnrollToClassForm","userType","learners","classDetails","addToCart","extend","modalShow","setModalShow","promptShow","setPromptShow","isLoading","setIsLoading","classStatus","setStatus","isFamilyAccount","FMLY","toLowerCase","navigate","dispatch","getOptions","map","learner","label","nickname","value","status","message","state","classes","get","classId","isLoggedIn","auth","authToken","checkIfEnrolledToClass","callback","learnersParam","item","id","post","join","then","response","data","catch","err","handleAddToCart","values","submit","enrollees","modalSubmit","action","Wrapper","span","startDate","classType","availabilityStartDate","endDate","availabilityEndDate","console","log","Date","handleOnSubmit","handleSubmit","borderTop","length","window","location","href","display","APPROVEDEDUC","type","icon","color"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Form } from \"react-final-form\";\nimport { CheckboxGroupControl } from \"../../common/Form/Inputs\";\n// import { enrollClassSoloLearner } from \"api/classEnroll\";\nimport { enrollClassSuccess } from '../../../redux/actions/class';\n// import { enrollClassSoloLearner, enrollClassFamily } from \"api/classEnroll\";\nimport { Button, Modal } from \"react-bootstrap\";\nimport \"./index.css\";\nimport { USER_TYPE, CLASS_STATUS, CLASS_STATUS_ALERT } from \"utils/constants\";\nimport { useNavigate } from \"react-router-dom\";\nimport { api } from '../../../api';\nimport LocalizedFormat from 'dayjs/plugin/localizedFormat';\nimport utc from 'dayjs/plugin/utc';\nimport timezone from 'dayjs/plugin/timezone';\nimport isSameOrAfter from 'dayjs/plugin/isSameOrAfter';\nimport isSameOrBefore from 'dayjs/plugin/isSameOrBefore';\nimport dayjs from \"dayjs\";\nimport { useEffect } from \"react\";\nimport styled from \"styled-components\";\n\nexport default function EnrollToClassForm({ userType, learners, classDetails, addToCart }) {\n  dayjs.extend(utc);\n  dayjs.extend(timezone);\n  dayjs.extend(isSameOrAfter);\n  dayjs.extend(isSameOrBefore);\n  dayjs.extend(LocalizedFormat);\n\n  const [modalShow, setModalShow] = useState(false);\n  const [promptShow, setPromptShow] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [classStatus, setStatus] = useState(\"\");\n\n  const isFamilyAccount = USER_TYPE.FMLY.toLowerCase() === userType;\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const getOptions = () =>\n    learners.map((learner) => ({ label: learner.nickname, value: learner }));\n\n  const { status, message } = useSelector((state) => state.classes.get('enroll') ? state.classes.get('enroll') : {});\n  const { classId } = classDetails;\n\n  const isLoggedIn = useSelector((state) => state.auth.authToken);\n\n  const checkIfEnrolledToClass = async(callback, learners) => {\n    const learnersParam = learners ? learners.map(item => item.id) : null\n    await api.post(\"/class-enroll/availability\", {classId, userType, learners: learners? learnersParam.join(\",\") : null}).then(response => {\n      if(response.data.status === 'success'){\n        callback(true);\n      }\n    }).catch(err => {\n      dispatch(enrollClassSuccess(err.response.data));\n      setModalShow(true);\n      callback(false);\n    });\n    setIsLoading(false);\n  }\n\n  const handleAddToCart = async (values) => {\n    setIsLoading(true);\n    checkIfEnrolledToClass(status => {\n      if(status){\n        addToCart(values);\n      }\n    }, values ? values.learners : null);\n  }\n\n  const submit = async (values) => {\n    // We pass relevant information to CheckoutPage through location.state\n    // CheckoutPage accesses state with useLocation hook\n    setIsLoading(true);\n    classDetails.enrollees = values ? values.learners : null;\n\n    checkIfEnrolledToClass(status => {\n      if(status){\n        navigate(`/checkout`, { state: { classId, classes: [classDetails]} });\n      }\n    }, values ? values.learners : null);\n  };\n\n  const modalSubmit = (action) => {\n    switch(action){\n      case 'cancel': navigate('/'); break;\n      case 'proceed': navigate(`/checkout`, { state: { classId, classes: [classDetails] } }); break;\n      default: return;\n    }\n  };\n\n  const Wrapper = styled.span`\n    .btn-success {\n      background: green;\n      border: 1px solid green;\n      text-transform: uppercase;\n    }\n  `\n\n  useEffect(() => {\n    // const enrollmentStart = classDetails.enrollmentStartDate;\n    // const enrollmentEnd = classDetails.enrollmentEndDate;\n    const startDate = classDetails.classType === \"CLT002\" ? classDetails.startDate : classDetails.availabilityStartDate;\n    const endDate = classDetails.classType === \"CLT002\" ? classDetails.endDate : classDetails.availabilityEndDate;\n\n    console.log(startDate);\n    console.log(endDate)\n    if(classDetails.status === 'CSTAT010'){\n      setStatus(\"CLASS_ONGOING\")\n    }else if(classDetails.status === 'CSTAT011'){\n        setStatus(\"CLASS_ENDED\")\n    }else{\n        // if(!!enrollmentStart && dayjs().isBefore(dayjs(enrollmentStart), new Date())){\n        //     setStatus(\"NOT_STARTED\")\n        // }else  if(!!enrollmentStart && !!enrollmentEnd && dayjs().isSameOrAfter(dayjs(enrollmentStart), new Date()) && dayjs().isSameOrBefore(dayjs(enrollmentEnd), new Date())){\n        if(!!startDate && dayjs().isSameOrBefore(startDate)){\n            setStatus(\"ONGOING_ENROLLMENT\")\n        }\n        // else if(!!enrollmentEnd && !!startDate && dayjs().isAfter(dayjs(enrollmentEnd), new Date()) && dayjs().isBefore(dayjs(startDate), new Date())){\n        //     setStatus(\"OPENS_SOON\")\n        // }\n        else if(!!startDate && !!endDate && dayjs().isSameOrAfter(dayjs(startDate), new Date()) && dayjs().isSameOrBefore(dayjs(endDate), new Date())){\n            setStatus(\"CLASS_ONGOING\")\n        }else{\n            setStatus(\"CLASS_ENDED\")\n        }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const handleOnSubmit = ()=>{\n    if (!isLoggedIn) {\n      setPromptShow(true);\n    } else {\n      submit();\n    }\n  }\n  return (\n    <Wrapper>\n      <Form\n        onSubmit={handleOnSubmit}\n        // onSubmit={!isLoggedIn ? () => window.location.href = '/register' : submit}\n        render={({ handleSubmit, values }) => (\n          <div className=\"mt-4 pt-4\" style={{ borderTop: \"1px solid #DDD\" }}>\n            {isFamilyAccount && (\n              <div className=\"row\">\n                <div className=\"col-xs-12 col-md-6\">\n                  <h5>Who will attend this class?</h5>\n                </div>\n                <div className=\"col-xs-12 col-md-6 text-right\">\n                  {/* <a href=\"#\"><i className=\"fa fa-plus mr-2\" /> Add Learners</a> */}\n                </div>\n              </div>\n            )}\n\n            {classStatus === 'ONGOING_ENROLLMENT' && <form onSubmit={handleSubmit} id=\"enroll-to-class\">\n              {isFamilyAccount && (\n                <CheckboxGroupControl options={getOptions()} name=\"learners\"/>\n              )}\n\n              <button\n                className=\"btn btn-success mt-2 w-100\"\n                disabled={(isFamilyAccount ? !values.learners?.length > 0 : false) || isLoading }\n                onClick={!isLoggedIn ? () => window.location.href = '/register' : () => handleAddToCart(values)}\n                type=\"button\"\n                // onClick={onClickEnrollClass}\n                // disabled={!learnerId && userType !== USER_TYPE.LRNR.toLowerCase()}\n              >\n                {/* ADD CLASS TO CART */}\n                <span style={{ display: isLoading ? 'inline-block' : 'none' }} class=\"spinner-border spinner-border-sm btn-load\" role=\"status\" aria-hidden=\"true\"></span>\n                Add to Cart\n              </button>\n              <button\n                className=\"btn btn-success mt-2 w-100\"\n                disabled={(isFamilyAccount ? !values.learners?.length > 0 : false) || isLoading || classDetails.status !== CLASS_STATUS.APPROVEDEDUC}\n                // onClick={onClickEnrollClass}\n                // disabled={!learnerId && userType !== USER_TYPE.LRNR.toLowerCase()}\n              >\n                {/* ADD CLASS TO CART */}\n                <span style={{ display: isLoading ? 'inline-block' : 'none' }} class=\"spinner-border spinner-border-sm btn-load\" role=\"status\" aria-hidden=\"true\"></span>\n                ENROLL NOW\n              </button>\n            </form>}\n            \n            {classStatus !== \"\" && classStatus !== 'ONGOING_ENROLLMENT' && <div className={`alert alert-${CLASS_STATUS_ALERT[classStatus].type} text-center`} role=\"alert\">\n                <i className={`${CLASS_STATUS_ALERT[classStatus].icon} mr-2`} style={{color:\"orange\"}}></i>\n                {CLASS_STATUS_ALERT[classStatus].message} \n                {/* {classStatus === \"NOT_STARTED\" && classDetails.enrollmentStartDate && (<b>{dayjs(classDetails.enrollmentStartDate).format('ll')}</b>)} */}\n            </div>}\n          </div>\n        )}\n      />\n      <Modal size=\"m\" show={modalShow} onHide={() => setModalShow(false)}>\n        <Modal.Header closeButton>\n          <Modal.Title>\n            {status === \"success\" ? \"Enrollment Pending\" : \"Enrollment Failed\"}\n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <p>\n            {message} {status === \"success\" ? \"Proceed to Payment?\" : \"Find other classes?\"}\n          </p>\n        </Modal.Body>\n        <Modal.Footer>\n          {status === \"error\" && (\n            <Button variant=\"primary\" onClick={() => modalSubmit(\"cancel\")}>\n              Continue\n            </Button>\n          )}\n          {status === \"success\" && (\n            <Button variant=\"link\" onClick={() => modalSubmit(\"cancel\")}>\n              Maybe Later\n            </Button>\n          )}\n          {status === \"success\" && (\n            <Button variant=\"primary\" onClick={() => modalSubmit(\"proceed\")}>\n              Proceed\n            </Button>\n          )}\n        </Modal.Footer>\n      </Modal>\n      <Modal size=\"m\" show={promptShow} onHide={() => setPromptShow(false)}>\n        <Modal.Header closeButton>\n          <Modal.Title>\n            Continue to Login/Register?\n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <p>\n            You should login to your account to proceed with enrollment.\n          </p>\n        </Modal.Body>\n        <Modal.Footer>\n          {\n            <Button variant=\"danger\" \n            onClick={() => setPromptShow(false)}\n            >\n              Cancel\n            </Button>\n          }\n          {\n            <Button variant=\"primary\" onClick={() => window.location.href = '/register'}>\n              Proceed\n            </Button>\n          }\n        </Modal.Footer>\n      </Modal>\n    </Wrapper>\n  );\n}"]},"metadata":{},"sourceType":"module"}