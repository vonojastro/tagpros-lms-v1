{"ast":null,"code":"var _jsxFileName = \"/Users/vonojastro/Desktop/lms-frontend-v2/src/components/ShoppingCart/index.jsx\",\n    _s = $RefreshSig$();\n\nimport { deleteCartItem, getShoppingCart } from \"api/cart\";\nimport React, { Fragment, useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useNavigate } from \"react-router-dom\";\nimport { toast } from \"react-toastify\";\nimport { toMoneyFormat } from 'utils/utils';\nimport './index.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ShoppingCart() {\n  _s();\n\n  var _selectedClasses$find;\n\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const cart = useSelector(state => state.cart ? state.cart.getIn(['data', 'cart']) : []);\n  const [shoppingCart, setShoppingCart] = useState({});\n  const [selectedClasses, setSelectedClasses] = useState([]);\n  const [cartTotal, setCartTotal] = useState(0);\n  const [checkBoxes, setCheckBoxes] = useState({});\n  const [errorLoading, setErrorLoading] = useState(false);\n  const loading = useSelector(state => state.uiElements.getIn(['loadingScreen']));\n  useEffect(() => {\n    loadData(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const loadData = () => {\n    setErrorLoading(false);\n    getShoppingCart(dispatch, (status, response) => {\n      if (status) {\n        parseShoppingCart(response);\n      } else {\n        setErrorLoading(true);\n      }\n    });\n  };\n\n  const parseShoppingCart = cart => {\n    const cartGroupedByTeacher = {};\n    cart.forEach(item => {\n      if (!cartGroupedByTeacher[item.teacherId]) {\n        cartGroupedByTeacher[item.teacherId] = {\n          teacher: item.teacherName,\n          photo: item.photo,\n          classes: []\n        };\n      }\n\n      cartGroupedByTeacher[item.teacherId].classes.push({ ...item,\n        enrollees: item.enrollees !== \"null\" ? JSON.parse(item.enrollees) : null\n      });\n    });\n    setShoppingCart(cartGroupedByTeacher);\n  };\n\n  const onClickCheckBox = async (e, source, cartItem, teacherId) => {\n    const classes = [...selectedClasses];\n\n    switch (source) {\n      case 'teacher':\n        await shoppingCart[cartItem].classes.forEach(item => {\n          const enrolleesCount = item.enrollees ? item.enrollees.length : 1;\n\n          if (e.target.checked) {\n            if (classes.findIndex(c => c.classId === item.classId) === -1) {\n              classes.push(item);\n              setCartTotal(prevState => parseFloat(prevState) + parseFloat(item.price) * enrolleesCount);\n              setCheckBoxes(prevState => ({ ...prevState,\n                [item.classId]: true,\n                [cartItem]: true,\n                all: classes.length === cart.length\n              }));\n            }\n          } else {\n            const idx = classes.findIndex(c => c.classId === item.classId);\n            classes.splice(idx, 1);\n            setCartTotal(prevState => parseFloat(prevState) - parseFloat(item.price) * enrolleesCount);\n            setCheckBoxes(prevState => ({ ...prevState,\n              [item.classId]: false,\n              [cartItem]: false,\n              all: classes.length === cart.length\n            }));\n          }\n        });\n        setSelectedClasses(classes);\n        break;\n\n      case 'class':\n        const enrolleesCount = cartItem.enrollees ? cartItem.enrollees.length : 1;\n        const idx = classes.findIndex(c => c.classId === cartItem.classId);\n\n        if (idx === -1) {\n          classes.push(cartItem);\n          setCartTotal(prevState => parseFloat(prevState) + parseFloat(cartItem.price) * enrolleesCount);\n        } else {\n          classes.splice(idx, 1);\n          setCartTotal(prevState => parseFloat(prevState) - parseFloat(cartItem.price) * enrolleesCount);\n        }\n\n        await setSelectedClasses(classes);\n        await setCheckBoxes(prevState => ({ ...prevState,\n          [e.target.name]: idx === -1,\n          [teacherId]: isCheckedTeacher(teacherId, classes),\n          all: classes.length === cart.length\n        }));\n        break;\n\n      case 'all':\n        const keys = Object.keys(shoppingCart);\n        keys.forEach(teacherId => {\n          shoppingCart[teacherId].classes.forEach(item => {\n            const enrolleesCount = item.enrollees ? item.enrollees.length : 1;\n\n            if (e.target.checked) {\n              if (classes.indexOf(item.classId) === -1) {\n                classes.push(item);\n                setCartTotal(prevState => parseFloat(prevState) + parseFloat(item.price) * enrolleesCount);\n                setCheckBoxes(prevState => ({ ...prevState,\n                  [teacherId]: true,\n                  [item.classId]: true,\n                  all: true\n                }));\n              }\n            } else {\n              classes.splice(0, classes.length);\n              setCartTotal(0);\n              setCheckBoxes(prevState => ({ ...prevState,\n                [teacherId]: false,\n                [item.classId]: false,\n                all: false\n              }));\n            }\n          });\n        });\n        await setSelectedClasses(classes);\n        break;\n\n      default:\n    }\n  };\n\n  const isCheckedTeacher = (itemId, classes) => {\n    const teacherClasses = shoppingCart[itemId].classes.map(item => item.classId);\n    const filtered = classes.filter(item => teacherClasses.indexOf(item.classId) > -1);\n    return teacherClasses.length === filtered.length;\n  };\n\n  const removeFromCart = async classId => {\n    const index = cart.findIndex(item => item.classId === classId);\n    const {\n      cartId\n    } = cart[index];\n    deleteCartItem(dispatch, {\n      cartId\n    }, status => {\n      if (status) {\n        toast.success('Item has been removed from cart.');\n        loadData();\n      } else {\n        toast.error('Failed removing item from cart. Please try again later.');\n      }\n    });\n  };\n\n  const handleCheckout = () => {\n    navigate(`/checkout`, {\n      state: {\n        classes: selectedClasses\n      }\n    });\n    console.log('selected', selectedClasses);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cart\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center data-loading\",\n        style: {\n          display: loading ? \"block\" : \"none\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"spinner-border text-primary\",\n          role: \"status\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"sr-only\",\n            children: \"Loading...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"loading-text\",\n          children: \"Loading Shopping Cart ...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        style: {\n          display: !loading && (Object.keys(shoppingCart).length < 1 || !!errorLoading) ? 'block' : 'none'\n        },\n        children: [Object.keys(shoppingCart).length < 1 && !errorLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"no-data\",\n          children: \"No Data Available\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 77\n        }, this), !!errorLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"no-data error\",\n          children: [\"There was an error loading the data. \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 58\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-link\",\n            onClick: loadData,\n            children: \"Reload\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 36\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 13\n      }, this), !loading && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          paddingBottom: '100px'\n        },\n        children: Object.keys(shoppingCart).map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card mb-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-header d-flex\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"checkbox checkbox-info\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"checkbox\",\n                id: item,\n                name: item,\n                onChange: e => onClickCheckBox(e, 'teacher', item),\n                checked: checkBoxes[item]\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 196,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: item,\n                children: [\" \", \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"ml-3\",\n                  children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                    className: \"mr-2\",\n                    style: {\n                      width: '27px',\n                      height: '100%',\n                      objectFit: 'contain',\n                      borderRadius: '50%',\n                      border: '1px lightgray solid'\n                    },\n                    alt: \"img\",\n                    src: shoppingCart[item].photo ? shoppingCart[item].photo : '../assets/images/image-placeholder.jpg'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 205,\n                    columnNumber: 41\n                  }, this), shoppingCart[item].teacher]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 204,\n                  columnNumber: 39\n                }, this), \" \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 203,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 195,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 194,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"card-body\",\n            children: shoppingCart[item].classes.map(classDetails => /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"row justify-content-between\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"d-flex col-7\",\n                  style: {\n                    maxWidth: '50%'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"checkbox checkbox-info mr-3 align-items-center d-flex\",\n                    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"checkbox\",\n                      id: classDetails.classId,\n                      name: classDetails.classId,\n                      onClick: e => onClickCheckBox(e, 'class', classDetails, item),\n                      checked: checkBoxes[classDetails.classId]\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 220,\n                      columnNumber: 41\n                    }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                      htmlFor: classDetails.classId,\n                      children: \" \"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 227,\n                      columnNumber: 41\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 219,\n                    columnNumber: 37\n                  }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n                    role: \"button\",\n                    onClick: () => navigate(`/class/enroll/${classDetails.classId}`),\n                    style: {\n                      width: '40px',\n                      height: '100%',\n                      objectFit: 'contain'\n                    },\n                    alt: \"img\",\n                    src: classDetails.thumbnailImage ? classDetails.thumbnailImage : '../assets/images/image-placeholder.jpg'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 231,\n                    columnNumber: 37\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"ml-2\",\n                    role: \"button\",\n                    onClick: () => navigate(`/class/enroll/${classDetails.classId}`),\n                    children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                      className: \"mb-0\",\n                      children: classDetails.title\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 238,\n                      columnNumber: 41\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        fontSize: '12px'\n                      },\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"mr-1\",\n                        children: [\"\\u2022\", classDetails.categoryCode, \"/\", classDetails.subCategoryCode]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 240,\n                        columnNumber: 45\n                      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"mr-1\",\n                        children: \"\\u20226 sessions\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 241,\n                        columnNumber: 45\n                      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"mr-1\",\n                        children: [\"\\u2022\", classDetails.ageCategory]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 242,\n                        columnNumber: 45\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 239,\n                      columnNumber: 41\n                    }, this), classDetails.enrollees && /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        fontSize: '14px'\n                      },\n                      children: classDetails.enrollees.map(item => /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"mr-1 badge badge-info\",\n                        children: item.nickname\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 245,\n                        columnNumber: 82\n                      }, this))\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 244,\n                      columnNumber: 68\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 234,\n                    columnNumber: 37\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 215,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"col-2 align-items-center d-flex\",\n                  children: toMoneyFormat(classDetails.price, classDetails.currency)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 249,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"col-2 align-items-center d-flex\",\n                  children: [\"x \", classDetails.enrollees ? classDetails.enrollees.length : 1]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 250,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn btn-link col-1\",\n                  style: {\n                    color: 'red'\n                  },\n                  onClick: () => removeFromCart(classDetails.classId, item),\n                  children: /*#__PURE__*/_jsxDEV(\"i\", {\n                    className: \"fas fa-trash\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 252,\n                    columnNumber: 37\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 251,\n                  columnNumber: 33\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 214,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(\"hr\", {\n                style: {\n                  marginLeft: '30px'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 255,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 213,\n              columnNumber: 26\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 211,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 18\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 26\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"footer\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex justify-content-end align-items-center\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            children: /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [\"Total Item (\", selectedClasses.length, \" item/s): \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"price\",\n                children: toMoneyFormat(cartTotal, (_selectedClasses$find = selectedClasses.find(_ref => {\n                  let {\n                    currency\n                  } = _ref;\n                  return currency.trim().length;\n                })) === null || _selectedClasses$find === void 0 ? void 0 : _selectedClasses$find.currency)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 262,\n                columnNumber: 76\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 262,\n              columnNumber: 27\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 262,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex justify-content-between align-items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"checkbox checkbox-info\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              id: \"allCheck\",\n              name: \"allCheck\",\n              onChange: e => onClickCheckBox(e, 'all'),\n              checked: checkBoxes.all\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 267,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"allCheck\",\n              children: [\" \", \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                children: [\"Select All (\", cart.length, \") \"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 275,\n                columnNumber: 35\n              }, this), \" \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 274,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-primary btn-lg\",\n              onClick: handleCheckout,\n              children: \"Checkout\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 279,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 176,\n    columnNumber: 5\n  }, this);\n}\n\n_s(ShoppingCart, \"rqM7Ld3un/jK7hlluLmHK+XDrHI=\", false, function () {\n  return [useDispatch, useNavigate, useSelector, useSelector];\n});\n\n_c = ShoppingCart;\n\nvar _c;\n\n$RefreshReg$(_c, \"ShoppingCart\");","map":{"version":3,"sources":["/Users/vonojastro/Desktop/lms-frontend-v2/src/components/ShoppingCart/index.jsx"],"names":["deleteCartItem","getShoppingCart","React","Fragment","useState","useEffect","useDispatch","useSelector","useNavigate","toast","toMoneyFormat","ShoppingCart","dispatch","navigate","cart","state","getIn","shoppingCart","setShoppingCart","selectedClasses","setSelectedClasses","cartTotal","setCartTotal","checkBoxes","setCheckBoxes","errorLoading","setErrorLoading","loading","uiElements","loadData","status","response","parseShoppingCart","cartGroupedByTeacher","forEach","item","teacherId","teacher","teacherName","photo","classes","push","enrollees","JSON","parse","onClickCheckBox","e","source","cartItem","enrolleesCount","length","target","checked","findIndex","c","classId","prevState","parseFloat","price","all","idx","splice","name","isCheckedTeacher","keys","Object","indexOf","itemId","teacherClasses","map","filtered","filter","removeFromCart","index","cartId","success","error","handleCheckout","console","log","display","paddingBottom","width","height","objectFit","borderRadius","border","classDetails","maxWidth","thumbnailImage","title","fontSize","categoryCode","subCategoryCode","ageCategory","nickname","currency","color","marginLeft","find","trim"],"mappings":"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","sourcesContent":["import { deleteCartItem, getShoppingCart } from \"api/cart\";\nimport React, {Fragment, useState, useEffect} from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useNavigate } from \"react-router-dom\";\nimport { toast } from \"react-toastify\";\nimport { toMoneyFormat } from 'utils/utils'\nimport './index.css'\n\nexport default function ShoppingCart() {\n    const dispatch = useDispatch();\n    const navigate = useNavigate();\n    const cart = useSelector((state) => state.cart ? state.cart.getIn(['data', 'cart']) : []);\n    const [shoppingCart, setShoppingCart] = useState({});\n    const [selectedClasses, setSelectedClasses] = useState([]);\n    const [cartTotal, setCartTotal] = useState(0);\n    const [checkBoxes, setCheckBoxes] = useState({});\n    const [errorLoading, setErrorLoading] = useState(false);\n    const loading = useSelector((state) => state.uiElements.getIn(['loadingScreen']));\n\n\n    useEffect(() => {\n        loadData();\n         // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n\n    const loadData = () => {\n        setErrorLoading(false);\n        getShoppingCart(dispatch, (status, response) => {\n            if(status){\n                parseShoppingCart(response);\n            }else{\n                setErrorLoading(true);\n            }\n        });\n    }\n\n    const parseShoppingCart =(cart) => {\n        const cartGroupedByTeacher = {};\n\n        cart.forEach(item => {\n            if(!cartGroupedByTeacher[item.teacherId]){\n                cartGroupedByTeacher[item.teacherId] = {\n                    teacher: item.teacherName,\n                    photo: item.photo,\n                    classes: []\n                };\n            }\n\n            cartGroupedByTeacher[item.teacherId].classes.push({...item, enrollees: item.enrollees !== \"null\" ? JSON.parse(item.enrollees) : null});\n        });\n        \n        setShoppingCart(cartGroupedByTeacher);\n    }\n\n    const onClickCheckBox = async (e, source, cartItem, teacherId) => {\n        const classes = [...selectedClasses];\n        switch(source){\n            case 'teacher': \n                await shoppingCart[cartItem].classes.forEach(item => {\n                    const enrolleesCount = item.enrollees ? item.enrollees.length : 1;\n                    if(e.target.checked){\n                        if(classes.findIndex(c => c.classId === item.classId) === -1){\n                            classes.push(item);\n                            setCartTotal((prevState) => (\n                                parseFloat(prevState) + (parseFloat(item.price)*enrolleesCount)\n                            ));\n                            setCheckBoxes((prevState) => ({\n                                ...prevState,\n                                [item.classId]: true,\n                                [cartItem]: true,\n                                all: classes.length === cart.length\n                            }));\n                        }\n                    }else{\n                        const idx = classes.findIndex(c => c.classId === item.classId);\n                        classes.splice(idx, 1);\n                        setCartTotal((prevState) => (\n                            parseFloat(prevState) - (parseFloat(item.price)*enrolleesCount)\n                        ));\n                        setCheckBoxes((prevState) => ({\n                            ...prevState,\n                            [item.classId]: false,\n                            [cartItem]: false,\n                            all: classes.length === cart.length\n                        }));\n                    }\n                });\n                setSelectedClasses(classes);\n                break;\n            case 'class':\n                const enrolleesCount = cartItem.enrollees ? cartItem.enrollees.length : 1;\n                const idx = classes.findIndex(c => c.classId === cartItem.classId);\n\n                if(idx === -1){\n                    classes.push(cartItem);\n                    setCartTotal((prevState) => (\n                        parseFloat(prevState) + (parseFloat(cartItem.price)*enrolleesCount)\n                    ));\n                }else{\n                    classes.splice(idx, 1);\n                    setCartTotal((prevState) => (\n                        parseFloat(prevState) - (parseFloat(cartItem.price)*enrolleesCount)\n                    ));\n                }\n\n                await setSelectedClasses(classes);\n\n                await setCheckBoxes((prevState) => ({\n                    ...prevState,\n                    [e.target.name]: idx === -1,\n                    [teacherId]: isCheckedTeacher(teacherId, classes),\n                    all: classes.length === cart.length\n                }));\n                break;\n            case 'all': \n                const keys = Object.keys(shoppingCart);\n                keys.forEach(teacherId => {\n                    shoppingCart[teacherId].classes.forEach(item => {\n                        const enrolleesCount = item.enrollees ? item.enrollees.length : 1;\n                        if(e.target.checked){\n                            if(classes.indexOf(item.classId) === -1){\n                                classes.push(item);\n                                setCartTotal((prevState) => (\n                                    parseFloat(prevState) + (parseFloat(item.price)*enrolleesCount)\n                                ));\n                                setCheckBoxes((prevState) => ({\n                                    ...prevState,\n                                    [teacherId]: true,\n                                    [item.classId]: true,\n                                    all: true\n                                }));\n                            }\n                        }else{\n                            classes.splice(0, classes.length);\n                            setCartTotal(0);\n                            setCheckBoxes((prevState) => ({\n                                ...prevState,\n                                [teacherId]: false,\n                                [item.classId]: false,\n                                all: false\n                            }));\n                        }\n                    });\n                });\n                await setSelectedClasses(classes);\n                break;\n            default:\n        }\n    }\n\n    const isCheckedTeacher = (itemId, classes) => {\n        const teacherClasses = shoppingCart[itemId].classes.map(item => item.classId);\n        const filtered = classes.filter(item => teacherClasses.indexOf(item.classId) > -1);\n        return teacherClasses.length === filtered.length\n    }\n\n    const removeFromCart = async(classId) => {\n        const index = cart.findIndex(item => item.classId === classId);\n        const {cartId} = cart[index];\n        deleteCartItem(dispatch, {cartId}, (status) => {\n            if(status){\n              toast.success('Item has been removed from cart.');\n              loadData();\n            }else{\n              toast.error('Failed removing item from cart. Please try again later.');\n            }\n        });\n    }\n\n    const handleCheckout = () => {\n        navigate(`/checkout`, { state: { classes: selectedClasses } });\n        console.log('selected', selectedClasses)\n    }\n\n  return (\n    <Fragment>\n        <div className=\"cart\">\n            <div className=\"text-center data-loading\" style={{display: loading ? \"block\" : \"none\"}}>\n                <div className=\"spinner-border text-primary\" role=\"status\">\n                    <span className=\"sr-only\">Loading...</span>\n                </div>\n                <div className=\"loading-text\">Loading Shopping Cart ...</div>\n            </div>\n            <div className=\"text-center\" style = {{display: (!loading && ((Object.keys(shoppingCart).length < 1) || !!errorLoading)) ? 'block': 'none'}}>\n                {(Object.keys(shoppingCart).length < 1 && !errorLoading) && <div className=\"no-data\">No Data Available</div>}\n                {!!errorLoading && <div className=\"no-data error\">\n                    There was an error loading the data. <br/>\n                    <button className=\"btn btn-link\" onClick={loadData}>Reload</button>\n                </div>}\n            </div>\n            {!loading && <div style={{paddingBottom: '100px'}}>\n                {Object.keys(shoppingCart).map(item => \n                (<div className=\"card mb-2\">\n                    <div className=\"card-header d-flex\">\n                        <div className=\"checkbox checkbox-info\">\n                            <input\n                                type=\"checkbox\"\n                                id={item}\n                                name={item}\n                                onChange={(e) => onClickCheckBox(e, 'teacher', item)}\n                                checked={checkBoxes[item]}\n                            />\n                            <label htmlFor={item}>\n                                {\" \"} <span className=\"ml-3\">\n                                        <img className=\"mr-2\" style={{width: '27px', height: '100%', objectFit: 'contain', borderRadius: '50%', border: '1px lightgray solid'}} alt=\"img\" src={shoppingCart[item].photo ? shoppingCart[item].photo : '../assets/images/image-placeholder.jpg'}/>\n                                        {shoppingCart[item].teacher}\n                                    </span>{\" \"}\n                            </label>\n                        </div>\n                    </div>\n                    <div class=\"card-body\">\n                        {shoppingCart[item].classes.map(classDetails => \n                        (<div>\n                            <div className=\"row justify-content-between\">\n                                <div \n                                    className=\"d-flex col-7\" style={{maxWidth: '50%'}}\n                                    \n                                >\n                                    <div className=\"checkbox checkbox-info mr-3 align-items-center d-flex\">\n                                        <input\n                                            type=\"checkbox\"\n                                            id={classDetails.classId}\n                                            name={classDetails.classId}\n                                            onClick={(e) => onClickCheckBox(e,'class', classDetails, item)}\n                                            checked={checkBoxes[classDetails.classId]}\n                                        />\n                                        <label htmlFor={classDetails.classId}>\n                                            {\" \"}\n                                        </label>\n                                    </div>\n                                    <img role=\"button\"\n                                        onClick={() => navigate(`/class/enroll/${classDetails.classId}`)}\n                                        style={{width: '40px', height: '100%', objectFit: 'contain'}} alt=\"img\" src={classDetails.thumbnailImage ? classDetails.thumbnailImage : '../assets/images/image-placeholder.jpg'}/>\n                                    <div className=\"ml-2\"\n                                        role=\"button\"\n                                        onClick={() => navigate(`/class/enroll/${classDetails.classId}`)}>\n                                        {/* <img height=\"100%\" src=\"https://tagprosbucket.s3-ap-southeast-1.amazonaws.com/xH6Sz9xtdbbEaqrR72Jse.jpg\" /> */}\n                                        <h5 className=\"mb-0\">{classDetails.title}</h5>\n                                        <div style={{fontSize: '12px'}}>\n                                            <span className=\"mr-1\">•{classDetails.categoryCode}/{classDetails.subCategoryCode}</span> \n                                            <span className=\"mr-1\">•6 sessions</span> \n                                            <span className=\"mr-1\">•{classDetails.ageCategory}</span>\n                                        </div>\n                                        {classDetails.enrollees && <div style={{fontSize: '14px'}}>\n                                            {classDetails.enrollees.map(item => (<span className=\"mr-1 badge badge-info\">{item.nickname}</span>))}\n                                        </div>}\n                                    </div>\n                                </div>\n                                <div className=\"col-2 align-items-center d-flex\">{toMoneyFormat(classDetails.price, classDetails.currency)}</div>\n                                <div className=\"col-2 align-items-center d-flex\">x {classDetails.enrollees ? classDetails.enrollees.length : 1}</div>\n                                <button className=\"btn btn-link col-1\" style={{color:'red'}} onClick={() => removeFromCart(classDetails.classId, item)}>\n                                    <i className=\"fas fa-trash\"></i>\n                                </button>\n                            </div>\n                            <hr style={{marginLeft: '30px'}}/>\n                        </div>))}\n                    </div>\n                </div>))}\n            </div>}\n            <div className=\"footer\">\n                <div className=\"d-flex justify-content-end align-items-center\">\n                    <span><b>Total Item ({selectedClasses.length} item/s): <span className=\"price\">{toMoneyFormat(cartTotal, selectedClasses.find(({currency})=>(currency.trim().length))?.currency)}</span></b></span>\n                </div>\n                <hr />\n                <div className=\"d-flex justify-content-between align-items-center\">\n                    <div className=\"checkbox checkbox-info\">\n                        <input\n                            type=\"checkbox\"\n                            id=\"allCheck\"\n                            name=\"allCheck\"\n                            onChange={(e) => onClickCheckBox(e,'all')}\n                            checked={checkBoxes.all}\n                        />\n                        <label htmlFor=\"allCheck\">\n                            {\" \"} <span>Select All ({cart.length}) </span>{\" \"}\n                        </label>\n                    </div>\n                    <div>\n                        <button className=\"btn btn-primary btn-lg\" onClick={handleCheckout}>Checkout</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </Fragment>\n  );\n}"]},"metadata":{},"sourceType":"module"}